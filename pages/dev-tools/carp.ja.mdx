import { FileTree } from "nextra/components";
import { Callout } from "nextra/components";

# Carp

[Carp](https://dcspark.github.io/carp/) ã¯ DcSpark ãŒé–‹ç™ºã—ãŸ PostgreSQL ã‚¤ãƒ³ãƒ‡ã‚¯ã‚µãƒ¼ ã§ã™ã€‚
PostgreSQL ã¨ã¯ã€ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§é–‹ç™ºã•ã‚Œã¦ã„ã‚‹ RDBMS(ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹) ã®ä¸€ã¤ã§ã€å¤šãã®é–‹ç™ºç¾å ´ã§åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

Carp ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æŒ‡å®šã—ãŸ Cardano Node ãŒæ‰€æœ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€å†…è”µã•ã‚Œã¦ã„ã‚‹ [Oura](https://github.com/txpipe/oura) ãŒãƒ«ãƒ¼ãƒ«ã«åŸºã¥ã„ã¦ãƒ‡ãƒ¼ã‚¿ã‚’è§£æã—ã€PostgreSQL ã«æ•´ç†ã—ã¦ä¿å­˜ã—ã¦ãã‚Œã¾ã™ã€‚

ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯ Carp ã‚’ä½¿ç”¨ã™ã‚‹æ‰‹é †ã®ä¸€ä¾‹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

### å‹•ä½œç’°å¢ƒ

- Ubuntu Server 22.04
- Rust
- PostgreSQL

### 1. Ubuntu ã®æ›´æ–°

ã¯ã˜ã‚ã«ã€Ubuntu ã‚’æœ€æ–°ã®çŠ¶æ…‹ã«æ›´æ–°ã—ã¾ã™ã€‚

```bash copy
sudo apt update -y && sudo apt upgrade -y
```

æ›´æ–°å¾Œã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ PostgreSQL ã‚’å«ã‚€ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash copy
sudo apt install -y git tmux curl postgresql
```

### 2. Rust ç’°å¢ƒæ§‹ç¯‰

Carp ã¯ Rust ã§æ›¸ã‹ã‚Œã¦ã„ã‚‹ãŸã‚ã€Rust ã®ç’°å¢ƒæ§‹ç¯‰ã‚’è¡Œã„ã¾ã™ã€‚

Rust ã®ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã§ã‚ã‚‹`rustup`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash copy
curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSf | sh
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®æº–å‚™ãŒã§ãã‚‹ã¨å¯¾è©±å½¢å¼ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«åˆ‡ã‚Šæ›¿ã‚ã‚‹ã®ã§ 1 ã® default ã‚ªãƒ—ã‚·ãƒ§ãƒ³ `1) Proceed with installation (default)` ã‚’é¸æŠã— Enter ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒæ­£å¸¸ã«çµ‚ã‚ã‚‹ã¨ã€`Rust is installed now. Great!`ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ç’°å¢ƒè¨­å®šã‚’åæ˜ ã—ã¾ã™ã€‚

```bash copy
source "$HOME/.cargo/env"
rustc --version
```

`rustup`ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æ­£å¸¸ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã™ã€‚

### 3. PostgreSQL ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹

PostgreSQL ã‚’èµ·å‹•ã—ã¾ã™ã€‚

```bash copy
sudo systemctl enable postgresql
sudo systemctl start postgresql
sudo systemctl --no-pager status postgresql
```

`active (exited)`ãŒæˆ»ã‚Šå€¤ã«å«ã¾ã‚Œã¦ã„ã‚Œã° PostgreSQL ãŒèµ·å‹•ã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ 3 è¡Œç›®ã®`createuser`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã‚ˆã†ã«æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚
å…¥åŠ›ã—ãŸå€¤ã¯ä»¥é™ã®ç’°å¢ƒè¨­å®šæ™‚ã«ä½¿ç”¨ã™ã‚‹ã®ã§ã€å¿…ãšæ§ãˆã¦ãŠã„ã¦ãã ã•ã„ã€‚

```bash copy
sudo -u postgres createdb carp_mainnet
sudo -u postgres psql -c 'ALTER DATABASE carp_mainnet SET jit_above_cost = -1;'
sudo -u postgres createuser carp
sudo -u postgres psql -t -d carp_mainnet -c 'GRANT ALL ON SCHEMA public TO carp;'
```

### 4. Carp ã‚’æ§‹æˆã™ã‚‹

<FileTree>
	<FileTree.Folder name="/home/usr" defaultOpen>
		<FileTree.Folder name="carp" defaultOpen>
			<FileTree.Folder name="indexer" defaultOpen></FileTree.Folder>
			<FileTree.Folder name="carp" defaultOpen></FileTree.Folder>
			<FileTree.File name="..." />
		</FileTree.Folder>
	</FileTree.Folder>
</FileTree>

dcSpark ã® Github ã‹ã‚‰ Carp ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’å–å¾—ã—ã¾ã™ã€‚

```bash copy
cd $HOME
git clone https://github.com/dcSpark/carp.git
```

Oura ã§æ¥ç¶šã™ã‚‹ Cardano node ã¨ PostgreSQL ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ§‹æˆã—ã¾ã™ã€‚

```bash copy
nano $HOME/carp/indexer/configs/oura.yml
```

<Callout type="info" emoji="ğŸ’¡">
  ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§aliasã‚’è¨­å®šã—ã¦ç›´æ„Ÿçš„ãªèµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã‚’ç™»éŒ²ã§ãã¾ã™ã€‚

```bash copy
echo alias carp="'cd $HOME/carp/indexer; cargo run -- --plan execution_plans/default.toml --config-path configs/oura.yml'" >> $HOME/.bashrc
source $HOME/.bashrc
```

è¨­å®šå¾Œã¯`carp`ã¨å…¥åŠ›ã™ã‚‹ã ã‘ã§èµ·å‹•ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
</Callout>
